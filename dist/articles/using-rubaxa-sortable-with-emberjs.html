<html><head><meta http-equiv="content-type" content="text/html;charset=utf-8"/><title>Using RubaXa Sortable with Ember.js | Timm Preetz</title><style>
      
    body {
        background-color: #ededed;
      }
      .contentWrapper {
        padding: 0 20px;
      }
      nav {
        /* 
        background-color: #313131 !important;
        position: fixed !important; */
      }
    
      
    
      body {
        font-family: "Avenir Next", "Segoe UI", "Helvetica Neue", sans-serif;
        font-weight: 400; /* TODO: use 200 for Helvetica Neue */
        font-size: 18px;
        margin: 0;
      }
    
  
    
      blockquote {
        margin-left: 0.25em;
        padding: 0px 1em 0px 1em;
        border-left: 1px solid #c0c0c0;
      }
    
      #mainWrapper {
        max-width: 900px;
        margin: auto;
        display: flex;
        flex-direction: column;
    
        margin-top: 40px;
        overflow-x: hidden;
    
        /*
        position: fixed;
        top: 40px;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: scroll;
        */
      }
    
      @media only all and (min-width: 415px) {
        #mainWrapper {
          padding: 0 15px;
        }
      }
    
      nav {
        padding: 0 20px;
        height: 40px;
        max-width: 900px;
        display: flex;
        flex-basis: 0;
        flex-grow: 1;
      }
    
      nav a {
        color: #313131;
        font-family: Futura;
        text-decoration: none;
        line-height: 40px;
      }
    
      nav a:hover {
        text-decoration: underline;
      }
    
      div.sbs {
        display: flex;
      }
    
      div.sbs > div {
        flex-grow: 1;  flex-basis: 0;
      }
    
      @media (max-width: 640px) {
        div.sbs {
          flex-direction: column;
        }
      }
    
      .recentPosts h1 {
        line-height: 1em;
        padding: 0px;
        margin: 0em 0;
      }
    
      .recentPosts a.postTitle {
        color: #313131;
        font-weight: 400;
        text-decoration: none;
      }
    
      .recentPosts a.postTitle:hover {
        text-decoration: underline;
      }
    
      .recentPosts hr {
        margin: 50px 0;
      }
    
      .recentPosts span {
        color: #313131;
        /* font-family: Courier, monospace; */
        font-weight: 400;
        font-size: 12px;
      }
    
      a, a:visited, a:hover, a:active {
        color: #313131;
      }
    
      a:hover {
        text-decoration: none;
      }
    
      hr {
        background-color: #bfbfbf;
        border: 0;
        height: 1px;
      }
    
      .homepageOverview {
        border-radius: 5px 5px 0 0; 
        padding: 20px;
      }
    
      #navWrapper {
        position: fixed;
        top: 0;
        height: 40px;
        left: 0;
        right: 0;
        display: flex;
        background-color: rgba(255,255,255,0.65);
        -webkit-backdrop-filter: blur(7px);
        z-index: 1;
        justify-content: center;
      }
    
      sup[id^=fnref] {
        padding-top: 40px;
        margin-top: -40px;
      }
    
      img {
        max-width: 100%;
      }</style><link rel="stylesheet" href="/assets/highlightjs.css"/></head><body><div id="navWrapper"><nav><a href="/" style="margin-right:20px"><img src="/assets/ava.jpg" width="30" height="30" style="margin-top:5px;float:left;border-radius:2px"/></a><a href="/projects">Projects</a>      <a href="/archive">Archive</a>      <a href="/about">About</a></nav></div><div id="mainWrapper"><div class="contentWrapper"><div><h1>Using RubaXa Sortable with Ember.js</h1>
<img src="/assets/posts/Sortable.gif" width="314">
<p><a href="http://rubaxa.github.io/Sortable/">Sortable by RubaXA</a> is a great library for visually sorting elements in HTML apps.
Sadly it has <a href="https://github.com/RubaXa/Sortable/issues/175">no built-in support for Ember.js</a>, so I thought I would elaborate here how I added it to a client's <a href="http://emberjs.com/">Ember.js</a> app.</p>
<h2>Creating a SortableList component</h2>
<p>app/components/sortable-list.js:</p>
<pre><code class="language-js"><span class="hljs-keyword">import</span> Ember <span class="hljs-keyword">from</span> <span class="hljs-string">'ember'</span>;
<span class="hljs-keyword">import</span> Sortable <span class="hljs-keyword">from</span> <span class="hljs-string">'npm:sortablejs'</span>; <span class="hljs-comment">// this requires Ember CLI with ember-browserify, which is great!</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Ember.Component.extend({
  <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._super();

    Ember.assert(<span class="hljs-string">'required `viewModels` param is set'</span>, !Ember.isNone(<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'viewModels'</span>)));
  },
  <span class="hljs-attr">tagName</span>: <span class="hljs-string">'ul'</span>,
  <span class="hljs-attr">classNames</span>: [<span class="hljs-string">'sortableList'</span>],
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-attr">removeItem</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
      <span class="hljs-keyword">this</span>.sendAction(<span class="hljs-string">'removeItem'</span>, index);
    }
  },
  <span class="hljs-attr">didInsertElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">'Setup Sortable in didInsertElement'</span>);

    <span class="hljs-keyword">let</span> s = Sortable.create(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'elementId'</span>)), {
      <span class="hljs-attr">draggable</span>: <span class="hljs-string">".sortableTopicListItem"</span>,
      <span class="hljs-attr">onSort</span>: <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (evt.type !== <span class="hljs-string">'sort'</span>) {
          <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">'Skipping event that is not sort.'</span>)
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (evt.oldIndex === evt.newIndex) {
          <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">'NOOP, evt.oldIndex === evt.newIndex; not sending action; not removing element'</span>);
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">`evt.oldIndex = <span class="hljs-subst">${evt.oldIndex}</span> -&gt; evt.newIndex = <span class="hljs-subst">${evt.newIndex}</span>`</span>);

        <span class="hljs-keyword">let</span> dragItem = evt.item;
        dragItem.parentNode.removeChild(dragItem);

        <span class="hljs-keyword">this</span>.sendAction(<span class="hljs-string">'itemMoved'</span>, evt.oldIndex, evt.newIndex);
      },
    });

    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Sortable'</span>, s); <span class="hljs-comment">// for later destruction</span>
  },
  <span class="hljs-attr">willDestroyElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">'destroying Sortable in willDestroyElement'</span>);
    <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Sortable'</span>).destroy();
  }
});
</code></pre>
<p>app/templates/components/sortable-list.hbs:</p>
<pre><code class="language-handlebars"><span class="xml">{% raw %}
</span><span class="hljs-template-tag">{{#<span class="hljs-name"><span class="hljs-builtin-name">each</span></span> viewModels as |viewModel index| }}</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sortableTopicListItem"</span>&gt;</span>
    </span><span class="hljs-template-variable">{{viewModel.displayName}}</span><span class="xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> </span></span><span class="hljs-template-variable">{{<span class="hljs-builtin-name">action</span> removeItem index}}</span><span class="xml"><span class="hljs-tag"> <span class="hljs-attr">class</span>=<span class="hljs-string">"remove"</span>&gt;</span>✖<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</span><span class="hljs-template-tag">{{/<span class="hljs-name"><span class="hljs-builtin-name">each</span></span>}}</span><span class="xml">
{% endraw %}
</span></code></pre>
<h2>Using the SortableList component</h2>
<p>Showing items with a SortableList is now very easy. All you have to do is supply some <code>viewModels</code> which have <code>displayName</code> property.</p>
<pre><code class="language-handlebars"><span class="xml">{% raw %}
</span><span class="hljs-template-variable">{{sortable-list viewModels=viewModels itemMoved='moveItem' removeItem='removeItem'}}</span><span class="xml">
{% endraw %}
</span></code></pre>
<p>It get's a little more complicated, when you want to reflect the actions that took place in the DOM in your internal data model.</p>
<p>For this the work the enclosing component has to implement <code>moveItem</code> and <code>removeItem</code> actions where it recreates the changes in it's internal store.</p>
<p>This is the relevant part from one of my enclosing components:</p>
<pre><code class="language-js">actions: {
  <span class="hljs-attr">moveItem</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">oldIndex, newIndex</span>) </span>{
    Ember.assert(<span class="hljs-string">'required `oldIndex` param is set'</span>, !Ember.isNone(oldIndex));
    Ember.assert(<span class="hljs-string">'required `newIndex` param is set'</span>, !Ember.isNone(newIndex));

    <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">`oldIndex = <span class="hljs-subst">${oldIndex}</span> -&gt; newIndex = <span class="hljs-subst">${newIndex}</span>`</span>);

    <span class="hljs-keyword">let</span> references = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'value'</span>); <span class="hljs-comment">// Your underlying array</span>

    <span class="hljs-keyword">let</span> movingReference = references.objectAt(oldIndex);

    references.removeAt(oldIndex, <span class="hljs-number">1</span>);
    references.insertAt(newIndex, movingReference);
  },
  <span class="hljs-attr">removeItem</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
    Ember.assert(<span class="hljs-string">'required `index` param is set'</span>, !Ember.isNone(index));

    <span class="hljs-keyword">let</span> references = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'value'</span>);
    references.removeAt(index, <span class="hljs-number">1</span>);
  }
}
</code></pre>
<p>I hope this is helpful for everyone looking to solve a similar problem.</p>
</div></div></div></body></html>